<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ligra Bank</title>

  <!-- Carrega React e ReactDOM via CDN -->
  <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://unpkg.com/lucide-react@0.459.0/dist/lucide-react.umd.js"></script>

  <!-- Tailwind via CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Script principal -->
  <script type="module">
    import { createRoot } from 'https://esm.sh/react-dom@18.3.1/client';

    // Aqui vamos injetar o c√≥digo do seu index.js manualmente
    // (porque o browser n√£o consegue importar .js diretamente sem server)
  </script>
</head>
<body>
  <div id="root">Carregando...</div>

  <script>
    // C√≥digo do seu index.js (copiado aqui para funcionar sem bundler)
    const GOOGLE_DOMAINS = ['prof.educacao.sp.gov.br', 'gmail.com'];
    const MICROSOFT_DOMAINS = ['professor.educacao.sp.gov.br', 'portalsesisp.org.br'];

    function WelcomeScreen({ onLoadData }) {
      const [email, setEmail] = React.useState('');
      const [error, setError] = React.useState('');

      const handleGoogleLogin = async () => {
        if (!GOOGLE_DOMAINS.some(d => email.toLowerCase().endsWith(d))) {
          setError('Use @prof.educacao.sp.gov.br ou @gmail.com para login autom√°tico.');
          return;
        }
        setError('');
        alert('‚ö†Ô∏è Google Drive n√£o funciona em HTML local. Use "Carregar do OneDrive".');
        onLoadData(null, 'local');
      };

      const handleLocalMicrosoft = () => {
        if (!MICROSOFT_DOMAINS.some(d => email.toLowerCase().endsWith(d))) {
          setError('Use @professor.educacao.sp.gov.br ou @portalsesisp.org.br para salvar no OneDrive.');
          return;
        }
        setError('');
        alert('‚úÖ Clique em "Salvar" depois para salvar no OneDrive.');
        onLoadData(null, 'local');
      };

      return (
        <div className="flex flex-col items-center justify-center min-h-screen bg-[#FFFDF5] p-4">
          <div className="bg-white p-8 rounded-3xl shadow-lg w-full max-w-md">
            <div className="text-center mb-6">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="#89C2F5" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
              <h1 className="text-2xl font-bold text-gray-800">Ligra Bank</h1>
              <p className="text-gray-600">Informe seu e-mail institucional</p>
            </div>

            {error && (
              <div className="mb-4 p-3 bg-red-50 text-red-700 rounded-lg flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm0-4a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/>
                  <path d="M8 10a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"/>
                </svg>
                {error}
              </div>
            )}

            <input
              type="email"
              value={email}
              onChange={(e) => setEmail(e.target.value)}
              placeholder="seu.email@instituicao.edu.br"
              className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-gray-50 focus:border-[#89C2F5] focus:outline-none mb-6"
            />

            <button
              onClick={handleGoogleLogin}
              disabled={!email}
              className="w-full py-3 mb-3 rounded-xl font-bold text-white bg-red-500 hover:bg-red-600 disabled:opacity-50 flex items-center justify-center gap-2"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm-2 15c-1.654 0-3-1.346-3-3s1.346-3 3-3 3 1.346 3 3-1.346 3-3 3zm0-5c-1.654 0-3-1.346-3-3s1.346-3 3-3 3 1.346 3 3-1.346 3-3 3z"/>
              </svg>
              Continuar com Google
            </button>

            <button
              onClick={handleLocalMicrosoft}
              disabled={!email}
              className="w-full py-3 rounded-xl font-bold text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 flex items-center justify-center gap-2"
            >
              <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
                <path d="M19 10H5v4h14v-4zM9 16H5v4h4v-4zM19 16h-4v4h4v-4zM10 6H5v4h5V6z"/>
              </svg>
              Carregar do OneDrive
            </button>

            <p className="mt-6 text-center text-xs text-gray-500">
              ‚Ä¢ Google: @prof.educacao.sp.gov.br ou @gmail.com<br />
              ‚Ä¢ OneDrive: @professor.educacao.sp.gov.br ou @portalsesisp.org.br
            </p>
          </div>
        </div>
      );
    }

    function SetupScreen({ onComplete }) {
      const [pin, setPin] = React.useState('');
      const [confirm, setConfirm] = React.useState('');
      const [error, setError] = React.useState('');

      const handleSubmit = () => {
        if (pin.length < 6) {
          setError('A senha deve ter pelo menos 6 caracteres.');
          return;
        }
        if (pin !== confirm) {
          setError('As senhas n√£o conferem.');
          return;
        }
        setError('');
        onComplete(pin);
      };

      return (
        <div className="flex flex-col items-center justify-center min-h-screen bg-[#FFFDF5] p-4">
          <div className="bg-white p-8 rounded-3xl shadow-lg w-full max-w-md">
            <div className="text-center mb-6">
              <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="#89C2F5" viewBox="0 0 24 24">
                <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
              </svg>
              <h2 className="text-xl font-bold text-gray-800">Configura√ß√£o Inicial</h2>
              <p className="text-gray-600">Crie sua senha de acesso</p>
            </div>

            {error && (
              <div className="mb-4 p-3 bg-red-50 text-red-700 rounded-lg flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm0-4a4 4 0 1 1 0-8 4 4 0 0 1 0 8z"/>
                  <path d="M8 10a2 2 0 1 1 0-4 2 2 0 0 1 0 4z"/>
                </svg>
                {error}
              </div>
            )}

            <input
              type="password"
              value={pin}
              onChange={(e) => setPin(e.target.value)}
              placeholder="Senha (m√≠n. 6 caracteres)"
              className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-gray-50 focus:border-[#89C2F5] focus:outline-none mb-4"
            />

            <input
              type="password"
              value={confirm}
              onChange={(e) => setConfirm(e.target.value)}
              placeholder="Confirme a senha"
              className="w-full px-4 py-3 rounded-xl border-2 border-gray-200 bg-gray-50 focus:border-[#89C2F5] focus:outline-none mb-6"
            />

            <button
              onClick={handleSubmit}
              className="w-full py-3 rounded-xl font-bold text-white bg-[#89C2F5] hover:bg-[#5B8FB3]"
            >
              Finalizar
            </button>
          </div>
        </div>
      );
    }

    function App() {
      const [data, setData] = React.useState(null);
      const [isSettingUp, setIsSettingUp] = React.useState(false);
      const [source, setSource] = React.useState(null);

      const handleLoadData = (loadedData, src) => {
        setSource(src);
        if (loadedData) {
          setData(loadedData);
        } else {
          setIsSettingUp(true);
        }
      };

      const handleSetupComplete = (pin) => {
        const newData = {
          professor: 'carregado_na_proxima',
          pinHash: pin,
          alunos: [],
          transacoes: [],
          ultimaAtualizacao: new Date().toISOString(),
        };
        setData(newData);
        setIsSettingUp(false);
      };

      const handleSave = () => {
        if (!data) return;
        if (source === 'google') {
          alert('‚ö†Ô∏è Google Drive n√£o funciona em HTML local. Use "Carregar do OneDrive".');
        } else if (source === 'local') {
          const dataStr = JSON.stringify(data, null, 2);
          const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
          const link = document.createElement('a');
          link.setAttribute('href', dataUri);
          link.setAttribute('download', 'ligra_bank_data.json');
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          alert('‚úÖ Dados salvos como arquivo local. Salve na pasta do OneDrive!');
        }
      };

      if (isSettingUp) {
        return <SetupScreen onComplete={handleSetupComplete} />;
      }

      if (!data) {
        return <WelcomeScreen onLoadData={handleLoadData} />;
      }

      return (
        <div className="min-h-screen bg-[#FFFDF5] p-4">
          <div className="max-w-4xl mx-auto">
            <div className="bg-white rounded-2xl p-6 shadow">
              <div className="flex justify-between items-center mb-6">
                <h1 className="text-2xl font-bold text-gray-800">Ligra Bank</h1>
                <button
                  onClick={handleSave}
                  className="flex items-center gap-2 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700"
                >
                  <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17 3H7c-1.1 0-1.99.9-1.99 2L5 19c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 16l-4-4h2v-4h4v4h2l-4 4z"/>
                  </svg>
                  Salvar
                </button>
              </div>

              <div className="bg-blue-50 p-4 rounded-xl mb-6">
                <p className="text-blue-800">
                  üíæ Dados salvos na{' '}
                  <strong>{source === 'google' ? 'nuvem Google' : 'pasta do OneDrive'}</strong>
                </p>
              </div>

              <div className="text-center py-12">
                <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" fill="green" viewBox="0 0 24 24">
                  <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                </svg>
                <h2 className="text-xl font-bold mt-4">Sistema carregado!</h2>
                <p className="text-gray-600 mt-2">Adicione seus alunos, turmas e transa√ß√µes.</p>
              </div>
            </div>
          </div>
        </div>
      );
    }

    // Renderiza o app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>